<span><%= playlist.name %></span><i class="fa fa-caret-right expand-playlist" data-playlist-id="<%=playlist.id%>"></i>
<%= link_to edit_playlist_path(playlist), class: "edit-playlist btn btn-primary", remote: true do %>
  <i class="fa fa-pencil"></i>
<% end %>
<ul class="playlist-tracks" data-playlist-id="<%=playlist.id%>">
  <%= render partial: 'playlist_tracks/playlist_track', collection: playlist.playlist_tracks.rank(:position) %>
</ul>
<%= coffee_script_tag do %>
  $('ul.playlist-tracks').droppable({
    activeClass: "playlist-state-default"
    hoverClass: "playlist-state-hover"
    drop: (event, ui) ->
      trackType = ui.draggable.data('type')
      console.log(trackType)
      switch trackType
        when 'track'
          playlistId = $(this).data('playlist-id')
          trackId = ui.draggable.data('track-id')
          console.log("recevied track #{trackId} on playlist #{playlistId}")
          window.addToPlaylist(trackId, playlistId)
        when 'playlist_track'
        else
          console.log('unknown draggable type')

  })

  $('ul.playlist-tracks').sortable({
    items: 'li.track'
    cursor: 'move'
    update: (event, ui) ->
      playlistTrackId = ui.item.data('playlist-track-id')
      console.log(playlistTrackId)
      position = ui.item.index()
      console.log(position)
      playlistId = $(this).data('playlist-id')
      $.ajax(
        type: 'POST'
        url: "/playlists/#{playlistId}/update_order"
        dataType: 'json'
        data: { playlist_track: {playlist_track_id: playlistTrackId, position: position } }
      )

  })
<% end %>
